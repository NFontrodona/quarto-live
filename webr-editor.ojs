viewof _webr_editor_{{block_id}} = {
  const block_id = "{{block_id}}";
  const scriptContent = document.querySelector(`script[type=\"webr-${block_id}-contents\"]`).textContent;
  const block = JSON.parse(atob(scriptContent));

  // Evaluate in personal environment, default to not echoing source
  const options = {
    envir: await webROjs.webR.evalR(`new.env(parent = globalenv())`),
    echo: false,
  }

  // Parse block attributes
  Object.entries(block.attr).forEach(([k, v]) => {
    options[k] = String(v).toLowerCase() == 'true';
  });

  return webROjs.editor(block.code, options);
}
webROjs.WebREvaluator.process(_webr_editor_{{block_id}}.code, _webr_editor_{{block_id}}.options);
